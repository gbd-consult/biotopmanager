

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Installation der Datenbank &mdash; Administration GBD Biotopmanager  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Rechteverwaltung" href="rechte.html" />
    <link rel="prev" title="Administration BiotopManager Plugin" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Administration GBD Biotopmanager
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation der Datenbank</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#schema-biotope-erstellen">Schema biotope erstellen</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#biotope">biotope</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#import-vorhandener-biotopdaten">Import vorhandener Biotopdaten</a></li>
<li class="toctree-l2"><a class="reference internal" href="#schema-referenzen-erstellen">Schema referenzen erstellen</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aenderungen">aenderungen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beeintraechtigungen">beeintraechtigungen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#biotoptypen">biotoptypen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#erhaltungszustand">erhaltungszustand</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gefaehrdung">gefaehrdung</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kartierer">kartierer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#massnahmen">massnahmen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pflege">pflege</a></li>
<li class="toctree-l3"><a class="reference internal" href="#schutzstatus">schutzstatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stoerung">stoerung</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#anpassungen-der-biotopdaten-nach-dem-import">Anpassungen der Biotopdaten nach dem Import</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#datenfelder-transformieren">Datenfelder transformieren</a></li>
<li class="toctree-l3"><a class="reference internal" href="#umwandeln-des-geometrie-typs">Umwandeln des Geometrie-Typs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#komposit-felder-in-integer-arrays-konvertieren">Komposit-Felder in Integer Arrays konvertieren</a></li>
<li class="toctree-l3"><a class="reference internal" href="#referenz-auf-beeintraechtigungen">Referenz auf Beeintraechtigungen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gefaehrdung-aggregieren-zur-darstellung-ohne-speicherung">Gefaehrdung aggregieren zur Darstellung ohne Speicherung</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spalte-aenderungen-hinzufugen">Spalte aenderungen hinzufügen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#weitere-spaltentypen-anpassen">Weitere Spaltentypen anpassen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kompositattribute-in-arrays-umwandeln">Kompositattribute in Arrays umwandeln</a></li>
<li class="toctree-l3"><a class="reference internal" href="#umgewandelte-kompositspalten-loschen">Umgewandelte Kompositspalten löschen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#array-spalten-wieder-umbenennen">Array Spalten wieder umbenennen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indizes-erzeugen">Indizes erzeugen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spalte-gefahr-historisch-fullen">Spalte gefahr_historisch füllen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uberflussige-spalten-loschen">Überflüssige Spalten löschen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spaltentypen-anpassen">Spaltentypen anpassen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anpassungen-pflegezustand">Anpassungen Pflegezustand</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anpassungen-erhaltungszustand">Anpassungen Erhaltungszustand</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anpassungen-waldbiotop-und-pflege-bedarf">Anpassungen waldbiotop und pflege_bedarf</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anpassungen-schutzstatus">Anpassungen Schutzstatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#schutzstatus-transformieren">Schutzstatus transformieren</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qgis-view-locked-biotope-erstellen">QGIS VIEW locked_biotope erstellen</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#schema-historie-erstellen">Schema historie erstellen</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tabelle-biotope-historie">Tabelle biotope_historie</a></li>
<li class="toctree-l3"><a class="reference internal" href="#funktion-biotope-historie-snapshot">Funktion biotope_historie_snapshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#view-biotope-deleted-features">View biotope_deleted_features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#funktion-log-history">Funktion log_history</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trigger-biotope-trigger">TRIGGER biotope_trigger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bearbeitungstabelle-fur-den-administrator">Bearbeitungstabelle für den Administrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bearbeitungstabelle-fur-die-editorgruppe">Bearbeitungstabelle für die Editorgruppe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#anlegen-eines-beispiel-bearbeiters">Anlegen eines Beispiel Bearbeiters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#verwendung-des-import-skripts">Verwendung des Import Skripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rechte.html">Rechteverwaltung</a></li>
<li class="toctree-l1"><a class="reference internal" href="referenzdaten.html">Referenzdaten</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Administration GBD Biotopmanager</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Installation der Datenbank</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation-der-datenbank">
<h1>Installation der Datenbank<a class="headerlink" href="#installation-der-datenbank" title="Permalink to this headline">¶</a></h1>
<p>Für die Erstinstallation wird zuerst ein Admin-Benutzer <code class="docutils literal notranslate"><span class="pre">biotope_admin</span></code> für den PostGIS Datenbankserver erstellt, über den die Administration der Biotopdatenbank stattfindet.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">biotope_admin</span> <span class="k">WITH</span>
 <span class="n">LOGIN</span>
 <span class="n">SUPERUSER</span>
 <span class="k">INHERIT</span>
 <span class="n">CREATEDB</span>
 <span class="n">CREATEROLE</span>
 <span class="n">REPLICATION</span>
 <span class="k">CONNECTION</span> <span class="k">LIMIT</span> <span class="o">-</span><span class="mf">1</span>
 <span class="k">PASSWORD</span> <span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Danach kann optional ein Kommentar ergänzt werden, um die neue Rolle zu beschreiben.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">COMMENT</span> <span class="k">ON</span> <span class="k">ROLE</span> <span class="n">biotope_admin</span>
<span class="k">IS</span> <span class="s1">&#39;Administrator Biotopkataster Datenbank biotope&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Ergänzt wird nun auch die Benutzergruppe <code class="docutils literal notranslate"><span class="pre">biotope_editor</span></code>. In dieses Gruppenrolle werden Datenbanknutzer integriert, welche die Biotopdaten bearbeiten sollen.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">biotope_editor</span> <span class="k">WITH</span>
 <span class="n">NOSUPERUSER</span>
 <span class="k">INHERIT</span>
 <span class="n">NOCREATEDB</span>
 <span class="n">NOCREATEROLE</span>
 <span class="n">NOREPLICATION</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Danach kann optional ein Kommentar ergänzt werden, um die neue Rolle zu beschreiben.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">COMMENT</span> <span class="k">ON</span> <span class="k">ROLE</span> <span class="n">biotope_editor</span> <span class="k">IS</span> <span class="s1">&#39;Bearbeiter Biotopkataster Datenbank biotope&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Danach wird die Datenbank <code class="docutils literal notranslate"><span class="pre">biotope</span></code> erzeugt.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="n">CREATEDB</span> <span class="n">biotope</span> <span class="k">WITH</span> <span class="k">OWNER</span> <span class="o">=</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Für das Arbeiten mir räumlichen Daten wird die PostGIS Erweiterung installiert.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">EXTENSION</span> <span class="n">postgis</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Danach werden die notwendigen Schemas <code class="docutils literal notranslate"><span class="pre">historie</span></code>, <code class="docutils literal notranslate"><span class="pre">referenzen</span></code> und <code class="docutils literal notranslate"><span class="pre">biotope</span></code> mit den notwendigen Berechtigungen erzeugt.</p>
<p>SCHEMA historie</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">historie</span> <span class="k">AUTHORIZATION</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="n">historie</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="n">USAGE</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="n">historie</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>SCHEMA referenzen</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">referenzen</span> <span class="k">AUTHORIZATION</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="n">referenzen</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="n">USAGE</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="n">referenzen</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>CREATE SCHEMA biotope</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">biotope</span> <span class="k">AUTHORIZATION</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="n">biotope</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="n">USAGE</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="n">biotope</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Nachdem die Schemas erstellt sind wird das Grundgerüst der Datenbank <code class="docutils literal notranslate"><span class="pre">biotope</span></code> erweitert. Hierzu werden in den einzelnen Schemas weitere Tabellen, Berechtigungen, Indices und Funktionen erstellt.</p>
<div class="section" id="schema-biotope-erstellen">
<h2>Schema biotope erstellen<a class="headerlink" href="#schema-biotope-erstellen" title="Permalink to this headline">¶</a></h2>
<p>Alle aktuellen Biotopdaten werden im Schema <code class="docutils literal notranslate"><span class="pre">biotope</span></code> verwaltet.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_ogc_fid_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_ogc_fid_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">SEQUENCE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_ogc_fid_seq</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="n">USAGE</span> <span class="k">ON</span> <span class="k">SEQUENCE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_ogc_fid_seq</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="biotope">
<h3>biotope<a class="headerlink" href="#biotope" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Als nächstes wird die Tabelle <code class="docutils literal notranslate"><span class="pre">biotope.biotope</span></code> erstellt.</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span>
<span class="p">(</span>
<span class="n">ogc_fid</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;biotope.biotope_ogc_fid_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
<span class="k">identity</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">objnr_sbk</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">unr</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">ausbildung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">pflege_zustand</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">pflege_entwicklung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">pflege_bedarf</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">pflege_rueckstand</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">pflege</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">bt_code</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">wert</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">schutzstatus_orig</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">biotopkuerzel</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">erhaltungszustand_orig</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">geprueft</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">biotoptyp_art_nr</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">biotoptyp2_art_nr</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">waldbiotop</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">objnr_landkreise</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">tk25</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="k">name</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">status</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">flaeche</span> <span class="nb">double precision</span><span class="p">,</span>
<span class="n">num_geom</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">objnr</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">umfang</span> <span class="nb">double precision</span><span class="p">,</span>
<span class="n">beschreibung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">erfassung_wann</span> <span class="nb">timestamp</span> <span class="nb">without time zone</span><span class="p">,</span>
<span class="n">erfassung_wer</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">erfassung_bemerkung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">bearbeitung_wann</span> <span class="nb">timestamp</span> <span class="nb">without time zone</span><span class="p">,</span>
<span class="n">bearbeitung_wer</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">bearbeitung_bemerkung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">loeschung_wann</span> <span class="nb">timestamp</span> <span class="nb">without time zone</span><span class="p">,</span>
<span class="n">loeschung_wer</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">loeschung_bemerkung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">bekanntmachung_wann</span> <span class="nb">timestamp</span> <span class="nb">without time zone</span><span class="p">,</span>
<span class="n">bekanntmachung_wer</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">bekanntmachung_bemerkung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">wkb_geometry</span> <span class="n">geometry</span><span class="p">(</span><span class="n">MultiPolygon</span><span class="p">,</span><span class="mf">25833</span><span class="p">),</span>
<span class="n">tiere</span> <span class="nb">integer</span><span class="p">[],</span>
<span class="n">pflanzen</span> <span class="nb">integer</span><span class="p">[],</span>
<span class="n">pilze</span> <span class="nb">integer</span><span class="p">[],</span>
<span class="n">stoerungen</span> <span class="nb">integer</span><span class="p">[],</span>
<span class="n">beeintraechtigung_ids</span> <span class="nb">integer</span><span class="p">[],</span>
<span class="n">gefahr_historisch</span> <span class="nb">text</span><span class="p">[]</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
<span class="n">schutzstatus</span> <span class="nb">integer</span><span class="p">,</span>
<span class="n">erhaltungszustand</span> <span class="nb">integer</span><span class="p">,</span>
<span class="k">CONSTRAINT</span> <span class="n">biotope_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ogc_fid</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
 <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Danach wird die Sequence <code class="docutils literal notranslate"><span class="pre">biotope.biotope_objnr_seq</span></code> erstellt und entsprechende Rechte vergeben.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_objnr_seq</span>
 <span class="k">INCREMENT</span> <span class="mf">1</span>
 <span class="k">START</span> <span class="mf">50000</span>
 <span class="k">MINVALUE</span> <span class="mf">1</span>
 <span class="k">MAXVALUE</span> <span class="mf">9223372036854775807</span>
 <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_objnr_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Im Anschluss folgt die Funktion nextval_objnr()</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">nextval_objnr</span><span class="p">()</span>
<span class="k">RETURNS</span> <span class="nb">TEXT</span>
<span class="k">LANGUAGE</span> <span class="k">sql</span>
<span class="k">AS</span>
<span class="s1">&#39;$$&#39;</span>
  <span class="k">SELECT</span> <span class="s1">&#39;14522-&#39;</span><span class="o">||</span><span class="n">to_char</span><span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;&quot;biotope&quot;.&quot;biotope_objnr_seq&quot;&#39;</span><span class="p">),</span> <span class="s1">&#39;FM00000&#39;</span><span class="p">);</span>
<span class="go">&#39;$$&#39;;</span>
</pre></div>
</div>
</div></blockquote>
<p>ALTER TABLE “biotope”.”biotope” ALTER COLUMN objnr SET DEFAULT nextval_objnr();</p>
<p>Dann werden mehrere Indices erstellt.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_bearbeitung_wann_idx</span>
  <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">USING</span> <span class="n">btree</span>
  <span class="p">(</span><span class="n">bearbeitung_wann</span><span class="p">)</span>
  <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_erfassung_wann_idx</span>
  <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">USING</span> <span class="n">btree</span>
  <span class="p">(</span><span class="n">erfassung_wann</span><span class="p">)</span>
  <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_flaeche_idx</span>
  <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">USING</span> <span class="n">btree</span>
  <span class="p">(</span><span class="n">flaeche</span><span class="p">)</span>
  <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_identity_idx</span>
  <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">USING</span> <span class="n">btree</span>
  <span class="p">(</span><span class="k">identity</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">)</span>
  <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_ogc_fid_idx</span>
  <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">USING</span> <span class="n">btree</span>
  <span class="p">(</span><span class="n">ogc_fid</span><span class="p">)</span>
  <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_umfang_idx</span>
  <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">USING</span> <span class="n">btree</span>
  <span class="p">(</span><span class="n">umfang</span><span class="p">)</span>
  <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_wkb_geometry_geom_idx</span>
  <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">USING</span> <span class="n">gist</span>
  <span class="p">(</span><span class="n">wkb_geometry</span><span class="p">)</span>
  <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Jetzt wird die Tabelle locks erstellen, die das Locken der Objekte managed.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locks_id_seq</span>
 <span class="k">INCREMENT</span> <span class="mf">1</span>
 <span class="k">START</span> <span class="mf">1</span>
 <span class="k">MINVALUE</span> <span class="mf">1</span>
 <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
 <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locks_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locks</span>
 <span class="p">(</span>
 <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;biotope.locks_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
 <span class="n">biotop_id</span> <span class="nb">integer</span><span class="p">,</span>
 <span class="n">user_id</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_USER</span><span class="p">,</span>
 <span class="n">mod_time</span> <span class="nb">timestamp</span> <span class="nb">without time zone</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">now</span><span class="p">(),</span>
 <span class="k">CONSTRAINT</span> <span class="n">locks_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
 <span class="k">CONSTRAINT</span> <span class="n">biotope_locks_uk1</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">biotop_id</span><span class="p">)</span>
 <span class="p">)</span>
 <span class="k">WITH</span> <span class="p">(</span>
  <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
 <span class="p">)</span>
 <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locks</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locks</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>An diesem Punkt ist das Datenmodell für den Hauptdatenbestand fertig. Der nächste Schritt
besteht darin, vorhandene, vorbereitete Biotopdaten in die Datenbank zu importieren.</p>
</div>
</div>
<div class="section" id="import-vorhandener-biotopdaten">
<h2>Import vorhandener Biotopdaten<a class="headerlink" href="#import-vorhandener-biotopdaten" title="Permalink to this headline">¶</a></h2>
<p>Die Altdaten müssen dem Aufbau der Tabelle Biotope entsprechen.</p>
<p>ogr2ogr -lco OVERWRITE=YES -progress -nln biotope -lco SCHEMA=biotope -nlt PROMOTE_TO_MULTI -geomfield wkb_geometry -f “PostgreSQL” PG:”dbname=biotope user=biotope_admin password=biotope_admin” ${1}</p>
</div>
<div class="section" id="schema-referenzen-erstellen">
<h2>Schema referenzen erstellen<a class="headerlink" href="#schema-referenzen-erstellen" title="Permalink to this headline">¶</a></h2>
<p>Im Schema <code class="docutils literal notranslate"><span class="pre">referenzen</span></code> sind alle Referenztabellen abgelegt. Diese werden in den Dialogen des QGIS Plugins genutzt, um Auswahlfelder für die Formulare zu generieren. Eine genauere Beschreibung der Referenzdaten findet sich im Kapitel Referenzdaten.</p>
<div class="section" id="aenderungen">
<h3>aenderungen<a class="headerlink" href="#aenderungen" title="Permalink to this headline">¶</a></h3>
<p>Wir beginnen mit der Tabelle <code class="docutils literal notranslate"><span class="pre">referenzen.aenderungen</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">aenderungen_id_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">aenderungen_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">aenderungen</span>
<span class="p">(</span>
   <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;referenzen.aenderungen_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
   <span class="n">aenderung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
   <span class="k">CONSTRAINT</span> <span class="n">aenderungen_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
 <span class="k">WITH</span> <span class="p">(</span>
 <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Und die entsprechenden Rechte vergeben.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">aenderungen</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">aenderungen</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">aenderungen</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="beeintraechtigungen">
<h3>beeintraechtigungen<a class="headerlink" href="#beeintraechtigungen" title="Permalink to this headline">¶</a></h3>
<p>Danach kommt die Tabelle <code class="docutils literal notranslate"><span class="pre">referenzen.beeintraechtigungen</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">beeintraechtigungen_id_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">beeintraechtigungen_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">beeintraechtigungen</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;referenzen.beeintraechtigungen_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
  <span class="n">beeintraechtigungen</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">beeintraechtigungen_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
  <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Und die entsprechenden Rechte.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">beeintraechtigungen</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">beeintraechtigungen</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">beeintraechtigungen</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="biotoptypen">
<h3>biotoptypen<a class="headerlink" href="#biotoptypen" title="Permalink to this headline">¶</a></h3>
<p>Danach kommt die Tabelle <code class="docutils literal notranslate"><span class="pre">referenzen.biotoptypen</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">biotoptypen_id_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">biotoptypen_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">biotoptypen</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;referenzen.biotoptypen_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
  <span class="n">btyp</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">nummer</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">vwv_2012</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">name_2002</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">name_2012</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">code_2002</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">code_2012</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">vwv_2002</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">schutz</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">id_biot_lfulg_2012</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">id_biot_alt</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">biotoptyp</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">untergruppe</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">biotopgruppe</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">lr_gr</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">biotoptypen_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
  <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Und die entsprechenden Rechte.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">biotoptypen</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">biotoptypen</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">biotoptypen</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="erhaltungszustand">
<h3>erhaltungszustand<a class="headerlink" href="#erhaltungszustand" title="Permalink to this headline">¶</a></h3>
<p>Danach kommt die Tabelle <code class="docutils literal notranslate"><span class="pre">referenzen.erhaltungszustand</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">erhaltungszustand_id_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">erhaltungszustand_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">erhaltungszustand</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;referenzen.erhaltungszustand_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
  <span class="n">wert</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">erhaltungszustand_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
  <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">erhaltungszustand</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">erhaltungszustand</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="gefaehrdung">
<h3>gefaehrdung<a class="headerlink" href="#gefaehrdung" title="Permalink to this headline">¶</a></h3>
<p>Danach kommt die Tabelle <code class="docutils literal notranslate"><span class="pre">referenzen.gefaehrdung</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">gefaehrdung_id_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">gefaehrdung_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">gefaehrdung</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;referenzen.gefaehrdung_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
  <span class="k">name</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">nummer</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="k">identity</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">gefaehrdung_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
  <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">gefaehrdung</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">gefaehrdung</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">gefaehrdung</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="kartierer">
<h3>kartierer<a class="headerlink" href="#kartierer" title="Permalink to this headline">¶</a></h3>
<p>Danach kommt die Tabelle <code class="docutils literal notranslate"><span class="pre">referenzen.kartierer</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">kartierer_id_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">kartierer_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">kartierer</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;referenzen.kartierer_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
  <span class="n">kartierer</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">anschrift</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">art_beauftragung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">kartierer_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
  <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">kartierer</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">kartierer</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">kartierer</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="massnahmen">
<h3>massnahmen<a class="headerlink" href="#massnahmen" title="Permalink to this headline">¶</a></h3>
<p>Danach kommt die Tabelle <code class="docutils literal notranslate"><span class="pre">referenzen.massnahmen</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">massnahmen_id_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">massnahmen_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">massnahmen</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;referenzen.massnahmen_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
  <span class="n">referenz</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">massnahme</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">beschreibung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">lr1</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">lr2</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">lr3</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">lr4</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">lr5</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">massnahmen_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
  <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">massnahmen</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">massnahmen</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">massnahmen</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="pflege">
<h3>pflege<a class="headerlink" href="#pflege" title="Permalink to this headline">¶</a></h3>
<p>Danach kommt die Tabelle <code class="docutils literal notranslate"><span class="pre">referenzen.pflege</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">pflege_id_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">pflege_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">pflege</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;referenzen.pflege_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
  <span class="k">name</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">nummer</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">beschreibung</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="k">identity</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">pflege_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
  <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">pflege</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">pflege</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">pflege</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="schutzstatus">
<h3>schutzstatus<a class="headerlink" href="#schutzstatus" title="Permalink to this headline">¶</a></h3>
<p>Danach kommt die Tabelle <code class="docutils literal notranslate"><span class="pre">referenzen.schutzstatus</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">schutzstatus_id_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">schutzstatus_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">schutzstatus</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;referenzen.schutzstatus_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
  <span class="n">wert</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">schutzstatus_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
  <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">schutzstatus</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">schutzstatus</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="stoerung">
<h3>stoerung<a class="headerlink" href="#stoerung" title="Permalink to this headline">¶</a></h3>
<p>Danach kommt die Tabelle <code class="docutils literal notranslate"><span class="pre">referenzen.stoerung</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">stoerung_id_seq</span>
  <span class="k">INCREMENT</span> <span class="mf">1</span>
  <span class="k">START</span> <span class="mf">1</span>
  <span class="k">MINVALUE</span> <span class="mf">1</span>
  <span class="k">MAXVALUE</span> <span class="mf">2147483647</span>
  <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">stoerung_id_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">stoerung</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;referenzen.stoerung_id_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">),</span>
  <span class="k">name</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="n">nummer</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="k">identity</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">stoerung_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
  <span class="k">OIDS</span> <span class="o">=</span> <span class="k">FALSE</span>
<span class="p">)</span>
<span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">stoerung</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">stoerung</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">stoerung</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="anpassungen-der-biotopdaten-nach-dem-import">
<h2>Anpassungen der Biotopdaten nach dem Import<a class="headerlink" href="#anpassungen-der-biotopdaten-nach-dem-import" title="Permalink to this headline">¶</a></h2>
<p>Nach dem Import der Daten aus der bisherigen Anwendung müssen die Biotopdaten
nochmals angepasst werden.</p>
<div class="section" id="datenfelder-transformieren">
<h3>Datenfelder transformieren<a class="headerlink" href="#datenfelder-transformieren" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">bearbeitung_wann</span> <span class="k">TYPE</span> <span class="nb">TIMESTAMP</span> <span class="k">using</span> <span class="n">to_timestamp</span><span class="p">(</span><span class="n">bearbeitung_wann</span><span class="p">,</span> <span class="s1">&#39;DD.MM.YYYY&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">erfassung_wann</span> <span class="k">TYPE</span> <span class="nb">TIMESTAMP</span> <span class="k">using</span> <span class="n">to_timestamp</span><span class="p">(</span><span class="n">erfassung_wann</span><span class="p">,</span> <span class="s1">&#39;DD.MM.YYYY&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">loeschung_wann</span> <span class="k">TYPE</span> <span class="nb">TIMESTAMP</span> <span class="k">using</span> <span class="n">to_timestamp</span><span class="p">(</span><span class="n">loeschung_wann</span><span class="p">,</span> <span class="s1">&#39;DD.MM.YYYY&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">bekanntmachung_wann</span> <span class="k">TYPE</span> <span class="nb">TIMESTAMP</span> <span class="k">using</span> <span class="n">to_timestamp</span><span class="p">(</span><span class="n">bekanntmachung_wann</span><span class="p">,</span> <span class="s1">&#39;DD.MM.YYYY&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">flaeche</span> <span class="k">TYPE</span> <span class="nb">DOUBLE PRECISION</span> <span class="k">using</span> <span class="n">ST_AREA</span><span class="p">(</span><span class="n">wkb_geometry</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">umfang</span> <span class="k">TYPE</span> <span class="nb">DOUBLE PRECISION</span> <span class="k">using</span> <span class="n">ST_LENGTH</span><span class="p">(</span><span class="n">ST_BOUNDARY</span><span class="p">(</span><span class="n">wkb_geometry</span><span class="p">));</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="umwandeln-des-geometrie-typs">
<h3>Umwandeln des Geometrie-Typs<a class="headerlink" href="#umwandeln-des-geometrie-typs" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div></blockquote>
<p>ALTER TABLE biotope.biotope ALTER COLUMN wkb_geometry TYPE geometry(MultiPolygon,25833);</p>
</div>
<div class="section" id="komposit-felder-in-integer-arrays-konvertieren">
<h3>Komposit-Felder in Integer Arrays konvertieren<a class="headerlink" href="#komposit-felder-in-integer-arrays-konvertieren" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">tiere_array</span> <span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">pflanzen_array</span> <span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">pilze_array</span> <span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">stoerungen_array</span> <span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">gefahr_array</span> <span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="referenz-auf-beeintraechtigungen">
<h3>Referenz auf Beeintraechtigungen<a class="headerlink" href="#referenz-auf-beeintraechtigungen" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">beeintraechtigung_ids</span> <span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="gefaehrdung-aggregieren-zur-darstellung-ohne-speicherung">
<h3>Gefaehrdung aggregieren zur Darstellung ohne Speicherung<a class="headerlink" href="#gefaehrdung-aggregieren-zur-darstellung-ohne-speicherung" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">gefahr_historisch</span> <span class="nb">text</span><span class="p">[];</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="spalte-aenderungen-hinzufugen">
<h3>Spalte aenderungen hinzufügen<a class="headerlink" href="#spalte-aenderungen-hinzufugen" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">aenderungen</span> <span class="nb">integer</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="weitere-spaltentypen-anpassen">
<h3>Weitere Spaltentypen anpassen<a class="headerlink" href="#weitere-spaltentypen-anpassen" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">num_geom</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">biotoptyp2_art_nr</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">tk25</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">ausbildung</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">pflege_zustand_orig</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">pflege_rueckstand</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">biotoptyp_art_nr</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">geprueft</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">naturraumnr</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">naturraumflussauennr</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">fanr</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">reviernr</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">imreviernr</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">eigentumsartnr</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">gefahrlevel</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">status</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="kompositattribute-in-arrays-umwandeln">
<h3>Kompositattribute in Arrays umwandeln<a class="headerlink" href="#kompositattribute-in-arrays-umwandeln" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">tiere_array</span> <span class="o">=</span> <span class="n">string_to_array</span><span class="p">(</span><span class="n">tiere</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">::</span><span class="nb">integer</span><span class="p">[];</span>



<span class="go">UPDATE biotope.biotope SET pflanzen_array = string_to_array(pflanzen, &#39;:&#39;)::integer[];</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">pilze_array</span> <span class="o">=</span> <span class="n">string_to_array</span><span class="p">(</span><span class="n">pilze</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">::</span><span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">stoerungen_array</span> <span class="o">=</span> <span class="n">string_to_array</span><span class="p">(</span><span class="n">stoerungen</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">::</span><span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">gefahr_array</span> <span class="o">=</span> <span class="n">string_to_array</span><span class="p">(</span><span class="n">gefahr</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">::</span><span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="umgewandelte-kompositspalten-loschen">
<h3>Umgewandelte Kompositspalten löschen<a class="headerlink" href="#umgewandelte-kompositspalten-loschen" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">tiere</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">pflanzen</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">pilze</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">stoerungen</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">gefahr</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="array-spalten-wieder-umbenennen">
<h3>Array Spalten wieder umbenennen<a class="headerlink" href="#array-spalten-wieder-umbenennen" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">RENAME</span> <span class="n">tiere_array</span> <span class="k">TO</span> <span class="n">tiere</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">RENAME</span> <span class="n">pflanzen_array</span> <span class="k">TO</span> <span class="n">pflanzen</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">RENAME</span> <span class="n">pilze_array</span> <span class="k">TO</span> <span class="n">pilze</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">RENAME</span> <span class="n">stoerungen_array</span> <span class="k">TO</span> <span class="n">stoerungen</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="indizes-erzeugen">
<h3>Indizes erzeugen<a class="headerlink" href="#indizes-erzeugen" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_ogc_fid_idx</span> <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span><span class="p">(</span><span class="n">ogc_fid</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_identity_idx</span> <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span><span class="p">(</span><span class="k">identity</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_erfassung_wann_idx</span> <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span><span class="p">(</span><span class="n">erfassung_wann</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_bearbeitung_wann_idx</span> <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span><span class="p">(</span><span class="n">bearbeitung_wann</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_flaeche_idx</span> <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span><span class="p">(</span><span class="n">flaeche</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_umfang_idx</span> <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span><span class="p">(</span><span class="n">umfang</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="spalte-gefahr-historisch-fullen">
<h3>Spalte gefahr_historisch füllen<a class="headerlink" href="#spalte-gefahr-historisch-fullen" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="n">bb</span>
<span class="k">SET</span> <span class="n">gefahr_historisch</span> <span class="o">=</span> <span class="n">subquery</span><span class="mf">.</span><span class="n">gefahr</span>
  <span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">t</span><span class="mf">.</span><span class="n">ogc_fid</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="k">SELECT</span> <span class="k">name</span> <span class="k">FROM</span> <span class="n">referenzen</span><span class="mf">.</span><span class="n">gefaehrdung</span> <span class="k">WHERE</span> <span class="n">nummer</span> <span class="o">=</span> <span class="k">ANY</span><span class="p">(</span><span class="k">SELECT</span> <span class="n">unnest</span><span class="p">(</span><span class="n">gefahr_array</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">WHERE</span> <span class="n">ogc_fid</span> <span class="o">=</span> <span class="n">t</span><span class="mf">.</span><span class="n">ogc_fid</span><span class="p">))</span> <span class="k">as</span> <span class="n">gefahr</span> <span class="k">FROM</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="n">t</span><span class="p">)</span> <span class="k">AS</span> <span class="n">subquery</span>
<span class="k">WHERE</span> <span class="n">bb</span><span class="mf">.</span><span class="n">ogc_fid</span> <span class="o">=</span> <span class="n">subquery</span><span class="mf">.</span><span class="n">ogc_fid</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="uberflussige-spalten-loschen">
<h3>Überflüssige Spalten löschen<a class="headerlink" href="#uberflussige-spalten-loschen" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">gefahr_array</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">flurstuecke</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">lage_tk25</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">lage</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">bemerkungen</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">abteilung</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">arten</span><span class="p">,</span>
  <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">werterhaltend</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="spaltentypen-anpassen">
<h3>Spaltentypen anpassen<a class="headerlink" href="#spaltentypen-anpassen" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">beeintraechtigung_ids</span> <span class="k">type</span> <span class="nb">integer</span><span class="p">[]</span> <span class="k">USING</span> <span class="n">beeintraechtigung_ids</span><span class="o">::</span><span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>ALTER TABLE “biotope”.”biotope” ALTER COLUMN objnr SET DEFAULT nextval_objnr();</p>
</div></blockquote>
</div>
<div class="section" id="anpassungen-pflegezustand">
<h3>Anpassungen Pflegezustand<a class="headerlink" href="#anpassungen-pflegezustand" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">pflege_zustand_code</span> <span class="nb">INTEGER</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">pflege_zustand_code</span> <span class="o">=</span> <span class="k">substring</span><span class="p">(</span><span class="n">pflege_zustand_orig</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="k">WHERE</span> <span class="n">pflege_zustand_orig</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;&#39;</span> <span class="k">AND</span> <span class="n">pflege_zustand_orig</span> <span class="k">is</span> <span class="k">not</span> <span class="k">NULL</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">RENAME</span> <span class="k">COLUMN</span> <span class="n">pflege_zustand</span> <span class="k">TO</span> <span class="n">pflege_zustand_orig</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">RENAME</span> <span class="k">COLUMN</span> <span class="n">pflege_zustand_code</span> <span class="k">TO</span> <span class="n">pflege_zustand</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="anpassungen-erhaltungszustand">
<h3>Anpassungen Erhaltungszustand<a class="headerlink" href="#anpassungen-erhaltungszustand" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">erhaltungszustand</span> <span class="o">=</span> <span class="mf">0</span> <span class="k">WHERE</span> <span class="n">erhaltungszustand</span> <span class="k">LIKE</span> <span class="s1">&#39;%:0%&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">erhaltungszustand</span> <span class="o">=</span> <span class="mf">1</span> <span class="k">WHERE</span> <span class="n">erhaltungszustand</span> <span class="k">LIKE</span> <span class="s1">&#39;%:1%&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">erhaltungszustand</span> <span class="o">=</span> <span class="mf">2</span> <span class="k">WHERE</span> <span class="n">erhaltungszustand</span> <span class="k">LIKE</span> <span class="s1">&#39;%:2%&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">erhaltungszustand</span> <span class="o">=</span> <span class="mf">3</span> <span class="k">WHERE</span> <span class="n">erhaltungszustand</span> <span class="k">LIKE</span> <span class="s1">&#39;%:3%&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">erhaltungszustand</span> <span class="k">TYPE</span> <span class="nb">INTEGER</span> <span class="k">USING</span> <span class="n">erhaltungszustand</span><span class="o">::</span><span class="nb">INTEGER</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="anpassungen-waldbiotop-und-pflege-bedarf">
<h3>Anpassungen waldbiotop und pflege_bedarf<a class="headerlink" href="#anpassungen-waldbiotop-und-pflege-bedarf" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">waldbiotop</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span> <span class="k">WHERE</span> <span class="n">waldbiotop</span> <span class="k">LIKE</span> <span class="s1">&#39;%1%&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">waldbiotop</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span> <span class="k">WHERE</span> <span class="n">waldbiotop</span> <span class="k">LIKE</span> <span class="s1">&#39;%0%&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">pflege_bedarf</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span> <span class="k">WHERE</span> <span class="n">pflege_bedarf</span> <span class="k">LIKE</span> <span class="s1">&#39;%1%&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">pflege_bedarf</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span> <span class="k">WHERE</span> <span class="n">pflege_bedarf</span> <span class="k">LIKE</span> <span class="s1">&#39;%0%&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="anpassungen-schutzstatus">
<h3>Anpassungen Schutzstatus<a class="headerlink" href="#anpassungen-schutzstatus" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">schutzstatus_code</span> <span class="nb">INTEGER</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">ogc_fid</span><span class="p">,</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="k">from</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">WHERE</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">ogc_fid</span><span class="p">,</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="k">from</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">WHERE</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="o">=</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">ogc_fid</span><span class="p">,</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="k">from</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">WHERE</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="o">=</span> <span class="mf">2</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">ogc_fid</span><span class="p">,</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="k">from</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">WHERE</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="o">=</span> <span class="mf">3</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">ogc_fid</span><span class="p">,</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="k">from</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">WHERE</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="o">=</span> <span class="mf">4</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="schutzstatus-transformieren">
<h3>Schutzstatus transformieren<a class="headerlink" href="#schutzstatus-transformieren" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">schutzstatus_code</span> <span class="o">=</span> <span class="mf">4</span> <span class="k">WHERE</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">schutzstatus_code</span> <span class="o">=</span> <span class="mf">3</span> <span class="k">WHERE</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="o">=</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">schutzstatus_code</span> <span class="o">=</span> <span class="mf">4</span> <span class="k">WHERE</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="o">=</span> <span class="mf">2</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">schutzstatus_code</span> <span class="o">=</span> <span class="mf">2</span> <span class="k">WHERE</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="o">=</span> <span class="mf">3</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">SET</span> <span class="n">schutzstatus_code</span> <span class="o">=</span> <span class="mf">1</span> <span class="k">WHERE</span> <span class="k">substring</span><span class="p">(</span><span class="n">schutzstatus</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span><span class="o">::</span><span class="nb">int</span> <span class="o">=</span> <span class="mf">4</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">RENAME</span> <span class="k">COLUMN</span> <span class="n">schutzstatus</span> <span class="k">TO</span> <span class="n">schutzstatus_orig</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">RENAME</span> <span class="k">COLUMN</span> <span class="n">schutzstatus_code</span> <span class="k">TO</span> <span class="n">schutzstatus</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="qgis-view-locked-biotope-erstellen">
<h3>QGIS VIEW locked_biotope erstellen<a class="headerlink" href="#qgis-view-locked-biotope-erstellen" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">VIEW</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locked_biotope</span>
 <span class="k">AS</span>
 <span class="k">SELECT</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">ogc_fid</span><span class="p">,</span>
  <span class="n">biotope</span><span class="mf">.</span><span class="k">identity</span><span class="p">,</span>
  <span class="n">biotope</span><span class="mf">.</span><span class="n">biotoptyp2_art_nr</span><span class="p">,</span>
  <span class="n">biotope</span><span class="mf">.</span><span class="n">wkb_geometry</span><span class="p">,</span>
  <span class="n">locks</span><span class="mf">.</span><span class="n">user_id</span>
 <span class="k">FROM</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span>
  <span class="k">JOIN</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locks</span> <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">ogc_fid</span> <span class="o">=</span> <span class="n">locks</span><span class="mf">.</span><span class="n">biotop_id</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locked_biotope</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locked_biotope</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="schema-historie-erstellen">
<h2>Schema historie erstellen<a class="headerlink" href="#schema-historie-erstellen" title="Permalink to this headline">¶</a></h2>
<p>Im Schema <code class="docutils literal notranslate"><span class="pre">historie</span></code> werden die historischen Biotope gespeichert.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SEQUENCE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie_revision_seq</span>
 <span class="k">INCREMENT</span> <span class="mf">1</span>
 <span class="k">START</span> <span class="mf">1</span>
 <span class="k">MINVALUE</span> <span class="mf">1</span>
 <span class="k">MAXVALUE</span> <span class="mf">9223372036854775807</span>
 <span class="k">CACHE</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">SEQUENCE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie_revision_seq</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">SEQUENCE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie_revision_seq</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="n">USAGE</span> <span class="k">ON</span> <span class="k">SEQUENCE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie_revision_seq</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="tabelle-biotope-historie">
<h3>Tabelle biotope_historie<a class="headerlink" href="#tabelle-biotope-historie" title="Permalink to this headline">¶</a></h3>
<p>Danach wird die eigentliche Tabelle <code class="docutils literal notranslate"><span class="pre">historie.biotope_historie</span></code> erstellt.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">AS</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">modtime</span> <span class="nb">TIMESTAMP</span> <span class="nb">WITH time zone</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">SET</span> <span class="n">modtime</span> <span class="o">=</span> <span class="n">now</span><span class="p">();</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">gefahrlevel</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">status</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="k">action</span> <span class="nb">text</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">revision</span> <span class="nb">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;historie.biotope_historie_revision_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">SET</span> <span class="k">action</span> <span class="o">=</span> <span class="s1">&#39;I&#39;</span> <span class="k">WHERE</span> <span class="n">status</span> <span class="k">LIKE</span> <span class="s1">&#39;%0:%&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">SET</span> <span class="k">action</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span> <span class="k">WHERE</span> <span class="n">status</span> <span class="k">LIKE</span> <span class="s1">&#39;%1:%&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">biotope_historie_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">revision</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">biotope_historie_action_check</span> <span class="k">CHECK</span> <span class="p">(</span><span class="k">action</span> <span class="o">=</span> <span class="k">ANY</span> <span class="p">(</span><span class="k">ARRAY</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="o">::</span><span class="nb">text</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="o">::</span><span class="nb">text</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="o">::</span><span class="nb">text</span><span class="p">]));</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">WHERE</span> <span class="n">status</span> <span class="k">LIKE</span> <span class="s1">&#39;%1:%&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">INSERT</span><span class="p">,</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Als nächstes werden eine Reihe notwendiger Indices für die Tabelle <code class="docutils literal notranslate"><span class="pre">historie.biotope_historie</span></code> erstellt. Als erstes der Index <code class="docutils literal notranslate"><span class="pre">historie.biotope_historie_action_idx</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_historie_action_idx</span>
  <span class="k">ON</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">USING</span> <span class="n">btree</span>
  <span class="p">(</span><span class="k">action</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span> <span class="k">ASC</span> <span class="k">NULLS</span> <span class="k">LAST</span><span class="p">)</span>
  <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Danach der Index <code class="docutils literal notranslate"><span class="pre">historie.biotope_historie_modtime_idx</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_historie_modtime_idx</span>
 <span class="k">ON</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">USING</span> <span class="n">btree</span>
 <span class="p">(</span><span class="n">modtime</span> <span class="k">ASC</span> <span class="k">NULLS</span> <span class="k">LAST</span><span class="p">)</span>
 <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Dann der Index <code class="docutils literal notranslate"><span class="pre">historie.biotope_revision_idx</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">biotope_revision_idx</span>
 <span class="k">ON</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">USING</span> <span class="n">btree</span>
 <span class="p">(</span><span class="n">revision</span> <span class="k">ASC</span> <span class="k">NULLS</span> <span class="k">LAST</span><span class="p">)</span>
 <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>und abschliessend der Index <code class="docutils literal notranslate"><span class="pre">historie.sidx_biotope_historie_wkb_geometry</span></code>.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">sidx_biotope_historie_wkb_geometry</span>
 <span class="k">ON</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">USING</span> <span class="n">gist</span>
 <span class="p">(</span><span class="n">wkb_geometry</span><span class="p">)</span>
 <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Die entsprechenden SQL Befehle sind auch in der Datei <code class="docutils literal notranslate"><span class="pre">biotope_historie_tabelle.sql</span></code> im Ordner <code class="docutils literal notranslate"><span class="pre">Schema_historie</span></code> abgelegt.</p>
</div>
<div class="section" id="funktion-biotope-historie-snapshot">
<h3>Funktion biotope_historie_snapshot<a class="headerlink" href="#funktion-biotope-historie-snapshot" title="Permalink to this headline">¶</a></h3>
<p>Als zweites wird im Schema <code class="docutils literal notranslate"><span class="pre">historie</span></code> die Funktion <code class="docutils literal notranslate"><span class="pre">historie.create_snapshot(time_stamp</span> <span class="pre">timestamp</span> <span class="pre">without</span> <span class="pre">time</span> <span class="pre">zone)</span></code> erstellt.</p>
<blockquote>
<div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Im folgendem SQL Code müssen die beiden Einträge <code class="docutils literal notranslate"><span class="pre">'$BODY$'</span></code> ersetzt werden durch <code class="docutils literal notranslate"><span class="pre">$BODY$</span></code>, also ohne Hochkomma.</p>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">historie</span><span class="mf">.</span><span class="n">create_snapshot</span><span class="p">(</span><span class="n">time_stamp</span> <span class="nb">timestamp</span> <span class="nb">without time zone</span><span class="p">)</span>
  <span class="k">RETURNS</span> <span class="nb">integer</span>
  <span class="k">LANGUAGE</span> <span class="s1">&#39;plpgsql&#39;</span>
  <span class="k">COST</span> <span class="mf">100</span>
  <span class="k">VOLATILE</span> <span class="k">PARALLEL</span> <span class="n">UNSAFE</span>
<span class="k">AS</span> <span class="s1">&#39;$BODY$&#39;</span>
<span class="k">DECLARE</span> <span class="n">num_rows</span> <span class="nb">INTEGER</span><span class="p">;</span>
<span class="go">BEGIN</span>
<span class="go">  DROP TABLE IF EXISTS historie.biotope_historie_snapshot;</span>
<span class="go">  CREATE TABLE historie.&quot;biotope_historie_snapshot&quot; (LIKE historie.biotope_historie INCLUDING ALL);</span>

<span class="go">  INSERT INTO historie.biotope_historie_snapshot SELECT * FROM historie.biotope_historie</span>
<span class="go">    WHERE action = &#39;I&#39; AND modtime &lt;= time_stamp;</span>

<span class="go">  UPDATE historie.&quot;biotope_historie_snapshot&quot;  SET ogc_fid = em.ogc_fid,identity = em.identity,objnr_sbk = em.objnr_sbk,unr = em.unr,ausbildung = em.ausbildung,pflege_zustand = em.pflege_zustand,pflege_entwicklung = em.pflege_entwicklung,pflege_bedarf = em.pflege_bedarf,pflege_rueckstand = em.pflege_rueckstand,pflege = em.pflege,bt_code = em.bt_code,wert = em.wert,schutzstatus = em.schutzstatus,biotopkuerzel = em.biotopkuerzel,erhaltungszustand = em.erhaltungszustand,geprueft = em.geprueft,biotoptyp_art_nr = em.biotoptyp_art_nr,biotoptyp2_art_nr = em.biotoptyp2_art_nr,waldbiotop = em.waldbiotop,objnr_landkreise = em.objnr_landkreise,tk25 = em.tk25,name = em.name,status = em.status,flaeche = em.flaeche,num_geom = em.num_geom,objnr = em.objnr,umfang = em.umfang,beschreibung = em.beschreibung,erfassung_wann = em.erfassung_wann,erfassung_wer = em.erfassung_wer,erfassung_bemerkung = em.erfassung_bemerkung,bearbeitung_wann = em.bearbeitung_wann,bearbeitung_wer = em.bearbeitung_wer,bearbeitung_bemerkung = em.bearbeitung_bemerkung,loeschung_wann = em.loeschung_wann,loeschung_wer = em.loeschung_wer,loeschung_bemerkung = em.loeschung_bemerkung,bekanntmachung_wann = em.bekanntmachung_wann,bekanntmachung_wer = em.bekanntmachung_wer,bekanntmachung_bemerkung = em.bekanntmachung_bemerkung,wkb_geometry = em.wkb_geometry,tiere = em.tiere,pflanzen = em.pflanzen,pilze = em.pilze,stoerungen = em.stoerungen,beeintraechtigung_ids = em.beeintraechtigung_ids,gefahr_historisch = em.gefahr_historisch, modtime = em.modtime FROM (SELECT &quot;ogc_fid&quot;,&quot;identity&quot;,&quot;objnr_sbk&quot;,&quot;unr&quot;,&quot;ausbildung&quot;,&quot;pflege_zustand&quot;,&quot;pflege_entwicklung&quot;,&quot;pflege_bedarf&quot;,&quot;pflege_rueckstand&quot;,&quot;pflege&quot;,&quot;bt_code&quot;,&quot;wert&quot;,&quot;schutzstatus&quot;,&quot;biotopkuerzel&quot;,&quot;erhaltungszustand&quot;,&quot;geprueft&quot;,&quot;biotoptyp_art_nr&quot;,&quot;biotoptyp2_art_nr&quot;,&quot;waldbiotop&quot;,&quot;objnr_landkreise&quot;,&quot;tk25&quot;,&quot;name&quot;,&quot;status&quot;,&quot;flaeche&quot;,&quot;num_geom&quot;,&quot;objnr&quot;,&quot;umfang&quot;,&quot;beschreibung&quot;,&quot;erfassung_wann&quot;,&quot;erfassung_wer&quot;,&quot;erfassung_bemerkung&quot;,&quot;bearbeitung_wann&quot;,&quot;bearbeitung_wer&quot;,&quot;bearbeitung_bemerkung&quot;,&quot;loeschung_wann&quot;,&quot;loeschung_wer&quot;,&quot;loeschung_bemerkung&quot;,&quot;bekanntmachung_wann&quot;,&quot;bekanntmachung_wer&quot;,&quot;bekanntmachung_bemerkung&quot;,&quot;wkb_geometry&quot;,&quot;tiere&quot;,&quot;pflanzen&quot;,&quot;pilze&quot;,&quot;stoerungen&quot;,&quot;beeintraechtigung_ids&quot;,&quot;gefahr_historisch&quot;,</span>
<span class="go">    modtime FROM historie.&quot;biotope_historie&quot; WHERE action = &#39;U&#39;</span>
<span class="go">    AND modtime &lt;= time_stamp ORDER BY modtime ASC) AS em</span>
<span class="go">    WHERE historie.&quot;biotope_historie_snapshot&quot;.ogc_fid = em.ogc_fid;</span>

<span class="go">  DELETE FROM historie.biotope_historie_snapshot WHERE ogc_fid in (SELECT ogc_fid FROM</span>
<span class="go">    historie.biotope_historie WHERE action = &#39;D&#39; AND modtime &lt;= time_stamp);</span>

<span class="go">  num_rows := (SELECT COUNT(*) from historie.&quot;biotope_historie_snapshot&quot;);</span>
<span class="go">  RETURN num_rows;</span>

<span class="go">EXCEPTION</span>

<span class="go">  WHEN data_exception THEN</span>
<span class="go">     RAISE WARNING &#39;[historie.create_snapshot] - UDF ERROR [DATA EXCEPTION] - SQLSTATE: %, SQLERRM: %&#39;,SQLSTATE,SQLERRM;</span>
<span class="go">     RETURN NULL;</span>
<span class="go">  WHEN unique_violation THEN</span>
<span class="go">     RAISE WARNING &#39;[historie.create_snapshot] - UDF ERROR [UNIQUE] - SQLSTATE: %, SQLERRM: %&#39;,SQLSTATE,SQLERRM;</span>
<span class="go">     RETURN NULL;</span>
<span class="go">  WHEN OTHERS THEN</span>
<span class="go">     RAISE WARNING &#39;[historie.create_snapshot] - UDF ERROR [OTHER] - SQLSTATE: %, SQLERRM: %&#39;,SQLSTATE,SQLERRM;</span>
<span class="go">     RETURN NULL;</span>
<span class="go">END;</span>
<span class="go">&#39;$BODY$&#39;;</span>
</pre></div>
</div>
</div></blockquote>
<p>Die Funktion <code class="docutils literal notranslate"><span class="pre">historie.create_snapshot(timestamp</span> <span class="pre">without</span> <span class="pre">time</span> <span class="pre">zone)</span></code> wird dem Benutzer <code class="docutils literal notranslate"><span class="pre">biotope_admin</span></code> als Besitzer zugewiesen.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">FUNCTION</span> <span class="n">historie</span><span class="mf">.</span><span class="n">create_snapshot</span><span class="p">(</span><span class="nb">timestamp</span> <span class="nb">without time zone</span><span class="p">)</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Die entsprechenden SQL Befehle sind auch in der Datei <code class="docutils literal notranslate"><span class="pre">create_snapshot_function.sql</span></code> im Ordner <code class="docutils literal notranslate"><span class="pre">Schema_historie</span></code> abgelegt.</p>
</div>
<div class="section" id="view-biotope-deleted-features">
<h3>View biotope_deleted_features<a class="headerlink" href="#view-biotope-deleted-features" title="Permalink to this headline">¶</a></h3>
<p>Als drittes wird im Schema <code class="docutils literal notranslate"><span class="pre">historie</span></code> der View <code class="docutils literal notranslate"><span class="pre">historie.biotope_deleted_features</span></code> erstellt.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">VIEW</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_deleted_features</span>
 <span class="k">AS</span>
 <span class="k">SELECT</span> <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">ogc_fid</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="k">identity</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">objnr_sbk</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">unr</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">ausbildung</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">pflege_zustand_orig</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">pflege_entwicklung</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">pflege_bedarf</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">pflege_rueckstand</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">pflege</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">bt_code</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">wert</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">schutzstatus</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">biotopkuerzel</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">erhaltungszustand</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">geprueft</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">biotoptyp_art_nr</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">biotoptyp2_art_nr</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">waldbiotop</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">objnr_landkreise</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">tk25</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="k">name</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">status</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">flaeche</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">num_geom</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">objnr</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">umfang</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">beschreibung</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">erfassung_wann</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">erfassung_wer</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">erfassung_bemerkung</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">bearbeitung_wann</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">bearbeitung_wer</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">bearbeitung_bemerkung</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">loeschung_wann</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">loeschung_wer</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">loeschung_bemerkung</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">bekanntmachung_wann</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">bekanntmachung_wer</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">bekanntmachung_bemerkung</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">wkb_geometry</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">tiere</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">pflanzen</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">pilze</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">stoerungen</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">beeintraechtigung_ids</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">gefahr_historisch</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">modtime</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="k">action</span><span class="p">,</span>
 <span class="n">biotope_historie</span><span class="mf">.</span><span class="n">revision</span>
 <span class="k">FROM</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span>
 <span class="k">WHERE</span> <span class="n">biotope_historie</span><span class="mf">.</span><span class="k">action</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span><span class="o">::</span><span class="nb">text</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Der View <code class="docutils literal notranslate"><span class="pre">historie.biotope_deleted_features</span></code> wird dem Benutzer <code class="docutils literal notranslate"><span class="pre">biotope_admin</span></code> als Besitzer zugewiesen. Ausserdem werden diesem und dem Benutzer <code class="docutils literal notranslate"><span class="pre">biotope_editor</span></code> Rechte auf die Tabelle gegeben.</p>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_deleted_features</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_deleted_features</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_deleted_features</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Die entsprechenden SQL Befehle sind auch in der Datei <code class="docutils literal notranslate"><span class="pre">biotope_deleted_features_view.sql</span></code> im Ordner <code class="docutils literal notranslate"><span class="pre">Schema_historie</span></code> abgelegt.</p>
</div>
<div class="section" id="funktion-log-history">
<h3>Funktion log_history<a class="headerlink" href="#funktion-log-history" title="Permalink to this headline">¶</a></h3>
<p>Als viertes wird im Schema <code class="docutils literal notranslate"><span class="pre">historie</span></code> die Trigger-Funktion <code class="docutils literal notranslate"><span class="pre">historie.log_history()</span></code> erstellt. Dazu wird zu Beginn eine Funktion zur Erstellung eines Zeitstempels definiert.</p>
<blockquote>
<div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Im folgendem SQL Code müssen die beiden Einträge <code class="docutils literal notranslate"><span class="pre">'$BODY$'</span></code> ersetzt werden durch <code class="docutils literal notranslate"><span class="pre">$BODY$</span></code>, also ohne Hochkomma.</p>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">historie</span><span class="mf">.</span><span class="n">log_history</span><span class="p">()</span>
  <span class="k">RETURNS</span> <span class="k">trigger</span>
  <span class="k">LANGUAGE</span> <span class="s1">&#39;plpgsql&#39;</span>
  <span class="k">COST</span> <span class="mf">100</span>
  <span class="k">VOLATILE</span> <span class="k">NOT</span> <span class="k">LEAKPROOF</span>
<span class="k">AS</span> <span class="s1">&#39;$BODY$&#39;</span>
<span class="k">DECLARE</span>
  <span class="n">testing</span> <span class="nb">TEXT</span><span class="p">;</span>
<span class="go">BEGIN</span>
<span class="go">  IF (TG_OP = &#39;UPDATE&#39;) THEN</span>
<span class="go">      INSERT INTO historie.&quot;biotope_historie&quot; (&quot;ogc_fid&quot;,&quot;identity&quot;,&quot;objnr_sbk&quot;,&quot;unr&quot;,&quot;aenderungen&quot;,&quot;ausbildung&quot;,&quot;pflege_zustand&quot;,&quot;pflege_entwicklung&quot;,&quot;pflege_bedarf&quot;,&quot;pflege_rueckstand&quot;,&quot;pflege&quot;,&quot;bt_code&quot;,&quot;wert&quot;,&quot;schutzstatus&quot;,&quot;biotopkuerzel&quot;,&quot;erhaltungszustand&quot;,&quot;geprueft&quot;,&quot;biotoptyp_art_nr&quot;,&quot;biotoptyp2_art_nr&quot;,&quot;waldbiotop&quot;,&quot;objnr_landkreise&quot;,&quot;tk25&quot;,&quot;name&quot;,&quot;status&quot;,&quot;flaeche&quot;,&quot;num_geom&quot;,&quot;objnr&quot;,&quot;umfang&quot;,&quot;beschreibung&quot;,&quot;erfassung_wann&quot;,&quot;erfassung_wer&quot;,&quot;erfassung_bemerkung&quot;,&quot;bearbeitung_wann&quot;,&quot;bearbeitung_wer&quot;,&quot;bearbeitung_bemerkung&quot;,&quot;loeschung_wann&quot;,&quot;loeschung_wer&quot;,&quot;loeschung_bemerkung&quot;,&quot;bekanntmachung_wann&quot;,&quot;bekanntmachung_wer&quot;,&quot;bekanntmachung_bemerkung&quot;,&quot;wkb_geometry&quot;,&quot;stoerungen&quot;,&quot;beeintraechtigung_ids&quot;,&quot;gefahr_historisch&quot;, action, modtime)</span>
<span class="go">      VALUES (NEW.&quot;ogc_fid&quot;,NEW.&quot;identity&quot;,NEW.&quot;objnr_sbk&quot;,NEW.&quot;unr&quot;,NEW.&quot;aenderungen&quot;,NEW.&quot;ausbildung&quot;,NEW.&quot;pflege_zustand&quot;,NEW.&quot;pflege_entwicklung&quot;,NEW.&quot;pflege_bedarf&quot;,NEW.&quot;pflege_rueckstand&quot;,NEW.&quot;pflege&quot;,NEW.&quot;bt_code&quot;,NEW.&quot;wert&quot;,NEW.&quot;schutzstatus&quot;,NEW.&quot;biotopkuerzel&quot;,NEW.&quot;erhaltungszustand&quot;,NEW.&quot;geprueft&quot;,NEW.&quot;biotoptyp_art_nr&quot;,NEW.&quot;biotoptyp2_art_nr&quot;,NEW.&quot;waldbiotop&quot;,NEW.&quot;objnr_landkreise&quot;,NEW.&quot;tk25&quot;,NEW.&quot;name&quot;,NEW.&quot;status&quot;,NEW.&quot;flaeche&quot;,NEW.&quot;num_geom&quot;,NEW.&quot;objnr&quot;,NEW.&quot;umfang&quot;,NEW.&quot;beschreibung&quot;,NEW.&quot;erfassung_wann&quot;,NEW.&quot;erfassung_wer&quot;,NEW.&quot;erfassung_bemerkung&quot;,NEW.&quot;bearbeitung_wann&quot;,NEW.&quot;bearbeitung_wer&quot;,NEW.&quot;bearbeitung_bemerkung&quot;,NEW.&quot;loeschung_wann&quot;,NEW.&quot;loeschung_wer&quot;,NEW.&quot;loeschung_bemerkung&quot;,NEW.&quot;bekanntmachung_wann&quot;,NEW.&quot;bekanntmachung_wer&quot;,NEW.&quot;bekanntmachung_bemerkung&quot;,NEW.&quot;wkb_geometry&quot;,NEW.&quot;stoerungen&quot;,NEW.&quot;beeintraechtigung_ids&quot;,NEW.&quot;gefahr_historisch&quot;, &#39;U&#39;, now());</span>
<span class="go">      RETURN NEW;</span>
<span class="go">  ELSIF (TG_OP = &#39;DELETE&#39;) THEN</span>
<span class="go">      INSERT INTO historie.&quot;biotope_historie&quot; (&quot;ogc_fid&quot;,&quot;identity&quot;,&quot;objnr_sbk&quot;,&quot;unr&quot;,&quot;aenderungen&quot;,&quot;ausbildung&quot;,&quot;pflege_zustand&quot;,&quot;pflege_entwicklung&quot;,&quot;pflege_bedarf&quot;,&quot;pflege_rueckstand&quot;,&quot;pflege&quot;,&quot;bt_code&quot;,&quot;wert&quot;,&quot;schutzstatus&quot;,&quot;biotopkuerzel&quot;,&quot;erhaltungszustand&quot;,&quot;geprueft&quot;,&quot;biotoptyp_art_nr&quot;,&quot;biotoptyp2_art_nr&quot;,&quot;waldbiotop&quot;,&quot;objnr_landkreise&quot;,&quot;tk25&quot;,&quot;name&quot;,&quot;status&quot;,&quot;flaeche&quot;,&quot;num_geom&quot;,&quot;objnr&quot;,&quot;umfang&quot;,&quot;beschreibung&quot;,&quot;erfassung_wann&quot;,&quot;erfassung_wer&quot;,&quot;erfassung_bemerkung&quot;,&quot;bearbeitung_wann&quot;,&quot;bearbeitung_wer&quot;,&quot;bearbeitung_bemerkung&quot;,&quot;loeschung_wann&quot;,&quot;loeschung_wer&quot;,&quot;loeschung_bemerkung&quot;,&quot;bekanntmachung_wann&quot;,&quot;bekanntmachung_wer&quot;,&quot;bekanntmachung_bemerkung&quot;,&quot;wkb_geometry&quot;,&quot;stoerungen&quot;,&quot;beeintraechtigung_ids&quot;,&quot;gefahr_historisch&quot;, action, modtime)</span>
<span class="go">      VALUES (OLD.&quot;ogc_fid&quot;,OLD.&quot;identity&quot;,OLD.&quot;objnr_sbk&quot;,OLD.&quot;unr&quot;,OLD.&quot;aenderungen&quot;,OLD.&quot;ausbildung&quot;,OLD.&quot;pflege_zustand&quot;,OLD.&quot;pflege_entwicklung&quot;,OLD.&quot;pflege_bedarf&quot;,OLD.&quot;pflege_rueckstand&quot;,OLD.&quot;pflege&quot;,OLD.&quot;bt_code&quot;,OLD.&quot;wert&quot;,OLD.&quot;schutzstatus&quot;,OLD.&quot;biotopkuerzel&quot;,OLD.&quot;erhaltungszustand&quot;,OLD.&quot;geprueft&quot;,OLD.&quot;biotoptyp_art_nr&quot;,OLD.&quot;biotoptyp2_art_nr&quot;,OLD.&quot;waldbiotop&quot;,OLD.&quot;objnr_landkreise&quot;,OLD.&quot;tk25&quot;,OLD.&quot;name&quot;,OLD.&quot;status&quot;,OLD.&quot;flaeche&quot;,OLD.&quot;num_geom&quot;,OLD.&quot;objnr&quot;,OLD.&quot;umfang&quot;,OLD.&quot;beschreibung&quot;,OLD.&quot;erfassung_wann&quot;,OLD.&quot;erfassung_wer&quot;,OLD.&quot;erfassung_bemerkung&quot;,OLD.&quot;bearbeitung_wann&quot;,OLD.&quot;bearbeitung_wer&quot;,OLD.&quot;bearbeitung_bemerkung&quot;,OLD.&quot;loeschung_wann&quot;,OLD.&quot;loeschung_wer&quot;,OLD.&quot;loeschung_bemerkung&quot;,OLD.&quot;bekanntmachung_wann&quot;,OLD.&quot;bekanntmachung_wer&quot;,OLD.&quot;bekanntmachung_bemerkung&quot;,OLD.&quot;wkb_geometry&quot;,OLD.&quot;stoerungen&quot;,OLD.&quot;beeintraechtigung_ids&quot;,OLD.&quot;gefahr_historisch&quot;, &#39;D&#39;, now());</span>
<span class="go">      RETURN OLD;</span>
<span class="go">  ELSIF (TG_OP = &#39;INSERT&#39;) THEN</span>
<span class="go">      INSERT INTO historie.&quot;biotope_historie&quot; (&quot;ogc_fid&quot;,&quot;identity&quot;,&quot;objnr_sbk&quot;,&quot;unr&quot;,&quot;aenderungen&quot;,&quot;ausbildung&quot;,&quot;pflege_zustand&quot;,&quot;pflege_entwicklung&quot;,&quot;pflege_bedarf&quot;,&quot;pflege_rueckstand&quot;,&quot;pflege&quot;,&quot;bt_code&quot;,&quot;wert&quot;,&quot;schutzstatus&quot;,&quot;biotopkuerzel&quot;,&quot;erhaltungszustand&quot;,&quot;geprueft&quot;,&quot;biotoptyp_art_nr&quot;,&quot;biotoptyp2_art_nr&quot;,&quot;waldbiotop&quot;,&quot;objnr_landkreise&quot;,&quot;tk25&quot;,&quot;name&quot;,&quot;status&quot;,&quot;flaeche&quot;,&quot;num_geom&quot;,&quot;objnr&quot;,&quot;umfang&quot;,&quot;beschreibung&quot;,&quot;erfassung_wann&quot;,&quot;erfassung_wer&quot;,&quot;erfassung_bemerkung&quot;,&quot;bearbeitung_wann&quot;,&quot;bearbeitung_wer&quot;,&quot;bearbeitung_bemerkung&quot;,&quot;loeschung_wann&quot;,&quot;loeschung_wer&quot;,&quot;loeschung_bemerkung&quot;,&quot;bekanntmachung_wann&quot;,&quot;bekanntmachung_wer&quot;,&quot;bekanntmachung_bemerkung&quot;,&quot;wkb_geometry&quot;,&quot;stoerungen&quot;,&quot;beeintraechtigung_ids&quot;,&quot;gefahr_historisch&quot;, action, modtime)</span>
<span class="go">      VALUES (NEW.&quot;ogc_fid&quot;,NEW.&quot;identity&quot;,NEW.&quot;objnr_sbk&quot;,NEW.&quot;unr&quot;,NEW.&quot;aenderungen&quot;,NEW.&quot;ausbildung&quot;,NEW.&quot;pflege_zustand&quot;,NEW.&quot;pflege_entwicklung&quot;,NEW.&quot;pflege_bedarf&quot;,NEW.&quot;pflege_rueckstand&quot;,NEW.&quot;pflege&quot;,NEW.&quot;bt_code&quot;,NEW.&quot;wert&quot;,NEW.&quot;schutzstatus&quot;,NEW.&quot;biotopkuerzel&quot;,NEW.&quot;erhaltungszustand&quot;,NEW.&quot;geprueft&quot;,NEW.&quot;biotoptyp_art_nr&quot;,NEW.&quot;biotoptyp2_art_nr&quot;,NEW.&quot;waldbiotop&quot;,NEW.&quot;objnr_landkreise&quot;,NEW.&quot;tk25&quot;,NEW.&quot;name&quot;,NEW.&quot;status&quot;,NEW.&quot;flaeche&quot;,NEW.&quot;num_geom&quot;,NEW.&quot;objnr&quot;,NEW.&quot;umfang&quot;,NEW.&quot;beschreibung&quot;,NEW.&quot;erfassung_wann&quot;,NEW.&quot;erfassung_wer&quot;,NEW.&quot;erfassung_bemerkung&quot;,NEW.&quot;bearbeitung_wann&quot;,NEW.&quot;bearbeitung_wer&quot;,NEW.&quot;bearbeitung_bemerkung&quot;,NEW.&quot;loeschung_wann&quot;,NEW.&quot;loeschung_wer&quot;,NEW.&quot;loeschung_bemerkung&quot;,NEW.&quot;bekanntmachung_wann&quot;,NEW.&quot;bekanntmachung_wer&quot;,NEW.&quot;bekanntmachung_bemerkung&quot;,NEW.&quot;wkb_geometry&quot;,NEW.&quot;stoerungen&quot;,NEW.&quot;beeintraechtigung_ids&quot;,NEW.&quot;gefahr_historisch&quot;, &#39;I&#39;, now());</span>
<span class="go">      RETURN NEW;</span>
<span class="go">  ELSE</span>
<span class="go">      RAISE WARNING &#39;[historie.log_history] - Other action occurred: %, at %&#39;,TG_OP,now();</span>
<span class="go">      RETURN NULL;</span>
<span class="go">  END IF;</span>

<span class="go">EXCEPTION</span>
<span class="go">  WHEN data_exception THEN</span>
<span class="go">      RAISE WARNING &#39;[historie.log_history] - UDF ERROR [DATA EXCEPTION] - SQLSTATE: %, SQLERRM: %&#39;,SQLSTATE,SQLERRM;</span>
<span class="go">      RETURN NULL;</span>
<span class="go">  WHEN unique_violation THEN</span>
<span class="go">      RAISE WARNING &#39;[historie.log_history] - UDF ERROR [UNIQUE] - SQLSTATE: %, SQLERRM: %&#39;,SQLSTATE,SQLERRM;</span>
<span class="go">      RETURN NULL;</span>
<span class="go">  WHEN OTHERS THEN</span>
<span class="go">      RAISE WARNING &#39;[historie.log_history] - UDF ERROR [OTHER] - SQLSTATE: %, SQLERRM: %&#39;,SQLSTATE,SQLERRM;</span>
<span class="go">      RETURN NULL;</span>
<span class="go">END;</span>
<span class="go">&#39;$BODY$&#39;;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">FUNCTION</span> <span class="n">historie</span><span class="mf">.</span><span class="n">log_history</span><span class="p">()</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="trigger-biotope-trigger">
<h3>TRIGGER biotope_trigger<a class="headerlink" href="#trigger-biotope-trigger" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">biotope_trigger</span>
 <span class="k">AFTER</span> <span class="k">INSERT</span> <span class="k">OR</span> <span class="k">DELETE</span> <span class="k">OR</span> <span class="k">UPDATE</span>
 <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span>
 <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
 <span class="k">EXECUTE</span> <span class="k">PROCEDURE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">log_history</span><span class="p">();</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="bearbeitungstabelle-fur-den-administrator">
<h2>Bearbeitungstabelle für den Administrator<a class="headerlink" href="#bearbeitungstabelle-fur-den-administrator" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_biotope_admin</span> <span class="k">AS</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">WITH</span> <span class="k">NO</span> <span class="k">DATA</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_biotope_admin</span> <span class="k">ADD</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ogc_fid</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_biotope_admin</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">ogc_fid</span> <span class="k">SET</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;biotope.biotope_ogc_fid_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">)</span> <span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="s s-Name">&quot;biotope&quot;</span><span class="mf">.</span><span class="s s-Name">&quot;biotope_edit_biotope_admin&quot;</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">objnr</span> <span class="k">SET</span> <span class="k">DEFAULT</span> <span class="n">nextval_objnr</span><span class="p">();</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_biotope_admin</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">beeintraechtigung_ids</span> <span class="k">type</span> <span class="nb">integer</span><span class="p">[]</span> <span class="k">USING</span> <span class="n">beeintraechtigung_ids</span><span class="o">::</span><span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_biotope_admin</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">gefahrlevel</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_biotope_admin</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">status</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_biotope_admin</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">pflege_zustand_code</span> <span class="nb">INTEGER</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">sidx_biotope_edit_biotope_admin_wkb_geometry</span>
 <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_biotope_admin</span> <span class="k">USING</span> <span class="n">gist</span>
 <span class="p">(</span><span class="n">wkb_geometry</span><span class="p">)</span>
 <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="k">INSERT</span><span class="p">,</span> <span class="k">UPDATE</span><span class="p">,</span> <span class="k">DELETE</span><span class="p">,</span> <span class="k">TRUNCATE</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_biotope_admin</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="k">INSERT</span><span class="p">,</span> <span class="k">UPDATE</span><span class="p">,</span> <span class="k">DELETE</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locks</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="bearbeitungstabelle-fur-die-editorgruppe">
<h2>Bearbeitungstabelle für die Editorgruppe<a class="headerlink" href="#bearbeitungstabelle-fur-die-editorgruppe" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="n">USAGE</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="n">biotope</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="n">USAGE</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="n">historie</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="n">USAGE</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="n">referenzen</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="n">USAGE</span><span class="p">,</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">ALL</span> <span class="k">SEQUENCES</span> <span class="k">IN</span> <span class="k">SCHEMA</span> <span class="n">biotope</span> <span class="k">to</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="n">USAGE</span><span class="p">,</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">ALL</span> <span class="k">SEQUENCES</span> <span class="k">IN</span> <span class="k">SCHEMA</span> <span class="n">historie</span> <span class="k">to</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">ALL</span> <span class="k">TABLES</span> <span class="k">IN</span> <span class="k">SCHEMA</span> <span class="n">referenzen</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">ALL</span> <span class="k">TABLES</span> <span class="k">IN</span> <span class="k">SCHEMA</span> <span class="n">historie</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">ALL</span> <span class="k">TABLES</span> <span class="k">IN</span> <span class="k">SCHEMA</span> <span class="n">biotope</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">INSERT</span><span class="p">,</span> <span class="k">UPDATE</span><span class="p">,</span> <span class="k">DELETE</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">INSERT</span><span class="p">,</span> <span class="k">UPDATE</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">historie</span><span class="mf">.</span><span class="n">biotope_historie</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locked_biotope</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="k">INSERT</span><span class="p">,</span> <span class="k">UPDATE</span><span class="p">,</span> <span class="k">DELETE</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">locks</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="anlegen-eines-beispiel-bearbeiters">
<h2>Anlegen eines Beispiel Bearbeiters<a class="headerlink" href="#anlegen-eines-beispiel-bearbeiters" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">mustermann</span> <span class="k">WITH</span>
 <span class="n">LOGIN</span>
 <span class="n">NOSUPERUSER</span>
 <span class="k">IN</span> <span class="k">ROLE</span> <span class="n">biotope_editor</span>
 <span class="k">INHERIT</span>
 <span class="n">NOCREATEDB</span>
 <span class="n">NOCREATEROLE</span>
 <span class="n">NOREPLICATION</span>
 <span class="k">CONNECTION</span> <span class="k">LIMIT</span> <span class="o">-</span><span class="mf">1</span>
 <span class="k">PASSWORD</span> <span class="s1">&#39;xxx&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">AS</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope</span> <span class="k">WITH</span> <span class="k">NO</span> <span class="k">DATA</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">ADD</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ogc_fid</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">ogc_fid</span> <span class="k">SET</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;biotope.biotope_ogc_fid_seq&#39;</span><span class="o">::</span><span class="n">regclass</span><span class="p">)</span> <span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">objnr</span> <span class="k">SET</span> <span class="k">DEFAULT</span> <span class="n">nextval_objnr</span><span class="p">();</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">beeintraechtigung_ids</span> <span class="k">type</span> <span class="nb">integer</span><span class="p">[]</span> <span class="k">USING</span> <span class="n">beeintraechtigung_ids</span><span class="o">::</span><span class="nb">integer</span><span class="p">[];</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">gefahrlevel</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span> <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">status</span> <span class="k">TYPE</span> <span class="nb">character</span> <span class="k">varying</span> <span class="k">COLLATE</span>  <span class="n">pg_catalog</span><span class="mf">.</span><span class="s s-Name">&quot;default&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">OWNER</span> <span class="k">to</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">TO</span> <span class="n">biotope_admin</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="k">INSERT</span><span class="p">,</span> <span class="k">UPDATE</span><span class="p">,</span> <span class="k">DELETE</span><span class="p">,</span> <span class="k">TRUNCATE</span> <span class="k">ON</span> <span class="k">TABLE</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">TO</span> <span class="n">biotope_editor</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">sidx_biotope_edit_mustermann_wkb_geometry</span>
 <span class="k">ON</span> <span class="n">biotope</span><span class="mf">.</span><span class="n">biotope_edit_mustermann</span> <span class="k">USING</span> <span class="n">gist</span>
 <span class="p">(</span><span class="n">wkb_geometry</span><span class="p">)</span>
 <span class="k">TABLESPACE</span> <span class="n">pg_default</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="verwendung-des-import-skripts">
<h2>Verwendung des Import Skripts<a class="headerlink" href="#verwendung-des-import-skripts" title="Permalink to this headline">¶</a></h2>
<p>Zusammengefasst finden Sie die Umsetzung des Datenmodells auch in den Skripten im Verzeichnis <code class="docutils literal notranslate"><span class="pre">skripte</span></code> und den Ablauf im Skript IMPORT.sh.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># USAGE: bash IMPORT.sh &amp;&gt; /tmp/biotopmanager.log</span>
cat create_database.sql <span class="p">|</span> psql
cat create_datamodell.sql <span class="p">|</span> <span class="nv">PGPASSWORD</span><span class="o">=</span>xxx psql -U biotope_admin biotope
cat create_biotope_schema.sql <span class="p">|</span> <span class="nv">PGPASSWORD</span><span class="o">=</span>xxx psql -U biotope_admin biotope
<span class="c1">#bash import_biotopdaten.sh /tmp/biotop_25833_all.geojson</span>
cat create_referenzen_schema.sql <span class="p">|</span> <span class="nv">PGPASSWORD</span><span class="o">=</span>xxx psql -U biotope_admin biotope
cat update_biotopdaten.sql <span class="p">|</span> <span class="nv">PGPASSWORD</span><span class="o">=</span>xxx psql -U biotope_admin biotope
cat create_historie_schema.sql <span class="p">|</span> <span class="nv">PGPASSWORD</span><span class="o">=</span>xxx psql -U biotope_admin biotope
cat update_biotope_admin.sql <span class="p">|</span> <span class="nv">PGPASSWORD</span><span class="o">=</span>xxx psql -U biotope_admin biotope
cat update_biotope_editor.sql <span class="p">|</span> <span class="nv">PGPASSWORD</span><span class="o">=</span>xxx psql -U biotope_admin biotope
</pre></div>
</div>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="rechte.html" class="btn btn-neutral float-right" title="Rechteverwaltung" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Administration BiotopManager Plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Geoinformatikbüro Dassau GmbH.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>